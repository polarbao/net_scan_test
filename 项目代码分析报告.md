# net_scam_soft_demo 项目代码分析报告

## 1. 项目概述

`net_scam_soft_demo` 项目是针对“融跃”（Royal）工业喷墨打印控制板的软件开发工具包（SDK）。它提供了一整套用于控制完整打印系统的必要组件，包括库、头文件、文档和示例代码。

该项目旨在演示如何通过网络控制一台基于融跃硬件的打印系统。该系统架构包括一个与PC连接的主控制板，该主板进一步管理多个驱动板、喷头和一套运动系统（如X/Y轴）。

## 2. 核心技术与实现对比

代码库中包含两个版本的演示应用程序：

*   **`NetScanDemo` (基于 MFC)**
    *   这是项目的主要参考实现，功能完整。
    *   它全面展示了SDK的各项能力，包括设备连接、参数设置、打印任务管理、运动控制和状态监控。
    *   对于理解SDK的完整功能和正确用法，**应以此MFC版本为准**。

*   **`qt` (基于 Qt)**
    *   这是一个将MFC版本移植到Qt框架的**未完成**版本。
    *   尽管它引用了相同的核心库（DLLs）并尝试实现相同的功能，但许多功能（如打印流程）仅有UI框架或未完全实现。
    *   它可作为跨平台开发的参考，但其功能完整性远不及MFC版本。

**结论**：`qt` 目录是 `NetScanDemo` 目录的一个不完整移植，两者共享底层的硬件控制逻辑，但上层应用实现有差异。

## 3. 核心模块分析

项目的核心功能由几个关键的动态链接库（DLL）和外部工具提供：

*   **`RYPrtCtler.dll` (核心打印控制器)**
    *   **功能**: 这是最主要的库，是打印功能的硬件抽象层（HAL）。它封装了与打印硬件通信的所有细节。
    *   **API**: `Inc/ryprtapi.h` 中定义了其API接口。
    *   **职责**:
        *   设备连接 (`DEV_OpenDevice`) 与初始化 (`DEV_InitDevice`)。
        *   打印任务管理 (`IDP_SartPrintJob`, `IDP_StopPrintJob`)。
        *   图像数据传输 (`IDP_WriteImgLayerData`)。
        *   设备状态监控 (`IDP_GetPrintState`, `DEV_GetDeviceInfo`)。
        *   系统参数配置。
    *   **文档**: `单卡网络版扫描系统打印开发手册 .pdf` 详细描述了其使用方法。

*   **`MoveCtl.dll` (运动控制器)**
    *   **功能**: 一个独立的库，用于控制打印机的运动系统（X/Y轴）。
    *   **API**: `Inc/MoveCtl.h` 中定义了其API接口。
    *   **职责**: 控制打印平台的物理移动，如 `DEM_MoveX`, `DEM_MoveY`，与打印喷墨动作精确同步。

*   **`SYSCFG.exe` / `GrayConfig.exe`**
    *   **功能**: 用于创建硬件配置文件（`.tcf`, `.grf`）的外部可视化工具。
    *   **职责**: 这些配置文件定义了喷头的物理布局、重叠关系、电压等关键硬件属性，`RYPrtCtler.dll` 在初始化时会加载这些配置。

## 4. 打印工作流程（基于MFC参考实现）

MFC版本的示例代码 (`NetScanDemoDlg.cpp`) 展示了一个典型的多线程打印流程：

1.  **初始化**:
    *   调用 `DEV_OpenDevice()` 连接硬件。
    *   调用 `DEV_InitDevice()` 并加载配置文件，完成设备初始化。

2.  **状态监控 (后台线程)**:
    *   启动一个独立的监控线程 (`MonitorThread`)。
    *   该线程循环调用 `IDP_GetPrintState` 和 `DEV_GetDeviceInfo` 等函数，持续获取并更新UI上的设备状态。

3.  **开始打印任务**:
    *   用户通过UI配置好打印参数后，调用 `IDP_SartPrintJob()` 启动一个打印任务。

4.  **图像数据加载 (数据线程)**:
    *   启动一个数据加载线程 (`PrintThreadSeparate`)。
    *   该线程负责从文件读取图像数据，并按“层”（Layer）通过 `IDP_WriteImgLayerData()` 函数写入到硬件控制器的缓冲区中。
    *   使用互斥锁（Mutex）来确保数据写入的线程安全。

5.  **执行物理打印 (打印线程)**:
    *   启动一个打印执行线程 (`PrintThread`)。
    *   该线程负责精确协调“喷墨”和“移动”两个动作。
    *   它通过 `IDP_StartLayerPrint()` 开始打印一层。
    *   在一层内，循环调用 `IDP_GetPassItem()` 获取每一“趟”（Pass）的打印数据。
    *   根据获取的数据，调用 `DEM_MoveX`/`DEM_MoveY` 控制平台移动到指定位置。
    *   调用 `IDP_DoPassPrint()` 执行该趟的喷墨。

6.  **任务完成**:
    *   所有层和趟都打印完毕后，调用 `IDP_StopPrintJob()` 结束打印任务。

## 5. 关键代码与文档参考

*   **`单卡网络版扫描系统打印开发手册 .pdf`**: **最重要**的文档，详细解释了系统架构、硬件和核心库 `RYPrtCtler.dll` 的API。
*   **`NetScanDemo/NetScanDemoDlg.cpp`**: MFC版本的核心实现文件，是学习如何正确使用SDK的最佳范例。包含了上述打印流程的完整实现。
*   **`Inc/ryprtapi.h`**: `RYPrtCtler.dll` 的头文件，定义了所有打印相关的API函数和关键数据结构（如 `PRTJOB_ITEM`, `PRTIMG_LAYER`）。
*   **`Inc/MoveCtl.h`**: `MoveCtl.dll` 的头文件，定义了运动控制相关的API。
*   **`qt/MainWindow.cpp`**: Qt版本的核心实现文件，可用于对比和了解Qt移植的思路，但其实现不完整。
